<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin - Digi Mitra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        let pin = prompt("Admin Security PIN:");
        if (pin !== "Rehan@786") { window.location.href = "index.html"; }
    </script>
    <style>
        :root { --blue: #0074D9; --navy: #001f3f; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        .admin-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; border-top: 4px solid var(--blue); }
        h2 { font-size: 16px; color: var(--navy); border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-bottom: 15px; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        .btn { background: var(--blue); color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .btn-del { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>

<div class="admin-card">
    <h2><i class="fas fa-rss"></i> Post Live Updates (Results/Forms/PAN/etc.)</h2>
    <div class="form-grid">
        <select id="updateType">
            <option value="results">Results</option>
            <option value="admitcards">Admit Cards</option>
            <option value="forms">Online Forms</option>
            <option value="pan">PAN Card</option>
            <option value="voter">Voter ID</option>
            <option value="aadhaar">Aadhaar</option>
        </select>
        <input type="text" id="updateTitle" placeholder="Title">
        <input type="text" id="updateLink" placeholder="Official Link">
    </div>
    <button class="btn" onclick="postUpdate()">Post Update</button>
</div>

<div class="admin-card">
    <h2><i class="fas fa-th-large"></i> Manage Home Page (Extra Help Cards)</h2>
    <p style="font-size: 11px; color: #666;">Yahan se aap Index page ke 10 niche wale cards change kar sakte hain.</p>
    <div class="form-grid">
        <input type="text" id="cardTitle" placeholder="Service Name (e.g. Resume Maker)">
        <input type="text" id="cardIcon" placeholder="FontAwesome Icon (e.g. fa-file-pdf)">
        <input type="text" id="cardLink" placeholder="Service Link">
    </div>
    <button class="btn" style="background:#2ecc71;" onclick="postExtraCard()">Update Index Card</button>
</div>

<div class="admin-card">
    <h2><i class="fas fa-tasks"></i> Manage Existing Content</h2>
    <table id="linksTable">
        <thead><tr><th>Category</th><th>Title</th><th>Action</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyA38pu8oY78SaLciR3JzwdwC4avpdEHBg4", authDomain: "formmitra-auth.firebaseapp.com", projectId: "formmitra-auth", databaseURL: "https://formmitra-auth-default-rtdb.asia-southeast1.firebasedatabase.app" };
    const app = initializeApp(firebaseConfig); const db = getDatabase(app);

    // Post to Results/Admit/etc.
    window.postUpdate = () => {
        const type = document.getElementById('updateType').value;
        const title = document.getElementById('updateTitle').value;
        const link = document.getElementById('updateLink').value;
        if(title && link) {
            push(ref(db, 'services/' + type), { title, link, timestamp: Date.now() });
            alert("Update Live!");
        }
    };

    // Post to Index Extra Cards
    window.postExtraCard = () => {
        const title = document.getElementById('cardTitle').value;
        const icon = document.getElementById('cardIcon').value;
        const link = document.getElementById('cardLink').value;
        if(title && link) {
            push(ref(db, 'index_extra'), { title, icon: icon || 'fa-star', link });
            alert("Index Card Added!");
        }
    };

    // Manage Links Table
    const cats = ['results', 'admitcards', 'forms', 'pan', 'voter', 'aadhaar', 'index_extra'];
    const tbody = document.querySelector('#linksTable tbody');
    cats.forEach(cat => {
        onValue(ref(db, 'services/' + cat), (snap) => { render(cat, snap.val()); });
        onValue(ref(db, 'index_extra'), (snap) => { render('index_extra', snap.val()); });
    });

    function render(cat, data) {
        if(!data) return;
        Object.keys(data).forEach(id => {
            const row = `<tr><td>${cat.toUpperCase()}</td><td>${data[id].title}</td><td><button class="btn-del" onclick="deleteItem('${cat}', '${id}')">Del</button></td></tr>`;
            tbody.innerHTML += row;
        });
    }

    window.deleteItem = (cat, id) => {
        const path = cat === 'index_extra' ? 'index_extra/' + id : 'services/' + cat + '/' + id;
        if(confirm("Delete karsun?")) remove(ref(db, path)).then(() => location.reload());
    };
</script>
</body>
</html>
