<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Form Mitra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f9; margin: 0; padding: 20px; }
        .profile-card { background: white; max-width: 500px; margin: 50px auto; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        .profile-header { background: #2c3e50; color: white; padding: 30px; text-align: center; }
        .profile-header i { font-size: 80px; margin-bottom: 10px; }
        .info-section { padding: 30px; }
        .info-group { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .label { font-size: 12px; color: #888; text-transform: uppercase; }
        .value { font-size: 16px; color: #333; font-weight: 600; }
        .actions { padding: 0 30px 30px; display: flex; flex-direction: column; gap: 10px; }
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; width: 100%; }
        .btn-logout { background: #ffc107; color: black; }
        .btn-delete { background: #e74c3c; color: white; }
    </style>
</head>
<body>

<div onclick="window.location.href='index.html'" style="cursor:pointer; color:#2c3e50; font-weight:bold;"><i class="fas fa-arrow-left"></i> Back to Dashboard</div>

<div class="profile-card">
    <div class="profile-header">
        <i class="fas fa-user-circle"></i>
        <h2 id="dispName">Loading...</h2>
        <p id="dispStatus">Status: Checking...</p>
    </div>

    <div class="info-section">
        <div class="info-group"><div class="label">Full Name</div><div class="value" id="valName">N/A</div></div>
        <div class="info-group"><div class="label">Phone</div><div class="value" id="valPhone">N/A</div></div>
        <div class="info-group"><div class="label">Email</div><div class="value" id="valEmail">N/A</div></div>
        <div class="info-group"><div class="label">Address</div><div class="value" id="valAddress">N/A</div></div>
    </div>

    <div class="actions">
        <button class="btn btn-logout" onclick="logout()">LOGOUT SESSION</button>
        <button class="btn btn-delete" onclick="deleteAccount()">DELETE ACCOUNT</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA38pu8oY78SaLciR3JzwdwC4avpdEHBg4",
        authDomain: "formmitra-auth.firebaseapp.com",
        projectId: "formmitra-auth",
        databaseURL: "https://formmitra-auth-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            get(ref(db, 'agents/' + user.uid)).then((snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('dispName').innerText = data.name;
                    document.getElementById('dispStatus').innerText = "Status: " + data.status;
                    document.getElementById('valName').innerText = data.name;
                    document.getElementById('valPhone').innerText = data.phone;
                    document.getElementById('valEmail').innerText = data.email;
                    document.getElementById('valAddress').innerText = data.address;
                }
            });
        } else { window.location.href = "login.html"; }
    });

    window.logout = () => { signOut(auth).then(() => { window.location.href = "login.html"; }); };

    window.deleteAccount = () => {
        if(confirm("Dhyan dein! Account delete karne se aapka saara data saaf ho jayega. Kya aap sure hain?")) {
            const user = auth.currentUser;
            remove(ref(db, 'agents/' + user.uid)).then(() => {
                deleteUser(user).then(() => {
                    alert("Account Deleted.");
                    window.location.href = "signup.html";
                });
            });
        }
    };
</script>
</body>
</html>