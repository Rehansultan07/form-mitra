<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Photo Editor - Form Mitra Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --secondary: #1e40af; --accent: #f59e0b; --bg-light: #f8fafc; }
        body { font-family: 'Poppins', sans-serif; background-color: #f3f4f6; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        .navbar { background: #1e3a8a; color: white; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .nav-brand { display: flex; align-items: center; gap: 10px; }
        .back-btn { background: var(--accent); color: #000; text-decoration: none; padding: 6px 15px; border-radius: 4px; font-weight: 600; font-size: 13px; }
        .ad-space { background: #fff; border: 1px dashed #bbb; margin: 10px auto; padding: 10px; text-align: center; font-size: 11px; color: #999; border-radius: 4px; max-width: 1000px; width: 90%; }

        .main-container { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 10px 20px 40px; }
        .editor-card { background: white; width: 100%; max-width: 1100px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
        .controls-panel { padding: 20px; background: #fff; flex: 1; border-right: 1px solid #e5e7eb; max-height: 85vh; overflow-y: auto; }
        .upload-btn-wrapper { margin-bottom: 20px; position: relative; }
        .btn-upload { border: 2px dashed var(--primary); color: var(--primary); background: #eff6ff; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
        
        .control-group { margin-bottom: 12px; background: var(--bg-light); padding: 10px; border-radius: 8px; }
        .control-label { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 600; color: #475569; }
        .slider-range { width: 100%; cursor: pointer; }
        .btn-download { background: linear-gradient(135deg, #059669, #047857); color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; }
        
        .editor-panel { flex: 2; background: #e2e8f0; display: flex; justify-content: center; align-items: center; padding: 20px; position: relative; min-height: 500px; }
        .canvas-container { box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 4px solid white; position: relative; }
        #editorCanvas { display: block; max-width: 100%; background: white; cursor: crosshair; }
        
        .tool-bar { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .tool-btn { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; background: white; font-size: 12px; font-weight: 600; }
        .tool-btn.active { background: var(--primary); color: white; }
        
        .seo-content { max-width: 1000px; width: 100%; margin-top: 30px; background: white; padding: 25px; border-radius: 12px; font-size: 14px; }
        @media (min-width: 768px) { .editor-card { flex-direction: row; } }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="nav-brand"><i class="fas fa-magic fa-lg"></i> <h1>Form Mitra Ultimate Editor</h1></div>
        <a href="dashboard.html" class="back-btn">Dashboard</a>
    </div>

    <div class="ad-space">Google AdSense Space (Header Ad)</div>

    <div class="main-container">
        <div class="editor-card">
            <div class="controls-panel">
                <div class="upload-btn-wrapper">
                    <button class="btn-upload"><i class="fas fa-upload"></i> Upload Image</button>
                    <input type="file" id="imageInput" accept="image/*" style="position:absolute; left:0; top:0; opacity:0; width:100%; height:100%; cursor:pointer;">
                </div>

                <div class="tool-bar">
                    <button class="tool-btn active" id="moveMode"><i class="fas fa-arrows-alt"></i> Move/Zoom</button>
                    <button class="tool-btn" id="eraseMode"><i class="fas fa-eraser"></i> Erase BG</button>
                </div>

                <div class="control-group" id="eraseSettings" style="display:none;">
                    <label class="control-label">Eraser Size: <span id="brushVal">20</span></label>
                    <input type="range" id="brushSize" class="slider-range" min="5" max="100" value="20">
                </div>

                <div class="control-group">
                    <label class="control-label">Background Color</label>
                    <input type="color" id="bgColor" value="#ffffff" style="width:100%; height:30px; cursor:pointer; border:none; padding:0;">
                </div>

                <div class="control-group">
                    <label class="control-label">üîç Zoom <span id="zoomValue">100%</span></label>
                    <input type="range" id="zoomSlider" class="slider-range" min="0.1" max="3" step="0.1" value="1">
                </div>

                <div class="control-group">
                    <label class="control-label">‚òÄÔ∏è Brightness <span id="brightValue">100%</span></label>
                    <input type="range" id="brightnessSlider" class="slider-range" min="0" max="200" value="100">
                </div>

                <div class="control-group" style="background: #fffbeb;">
                    <label class="control-label" style="color:#b45309;">üíæ Target Size (Quality)</label>
                    <input type="range" id="qualitySlider" class="slider-range" min="0.1" max="1.0" step="0.05" value="0.9">
                    <div id="sizeEstimate" style="font-weight:700; text-align:center; color:#0369a1; font-size:14px; margin-top:5px;">Size: - KB</div>
                </div>

                <button id="downloadBtn" class="btn-download" disabled><i class="fas fa-download"></i> Download Photo</button>
            </div>

            <div class="editor-panel">
                <div class="canvas-container">
                    <canvas id="editorCanvas" width="350" height="450"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const canvas = document.getElementById('editorCanvas');
        const ctx = canvas.getContext('2d');
        const downloadBtn = document.getElementById('downloadBtn');
        const zoomSlider = document.getElementById('zoomSlider');
        const bgColorInput = document.getElementById('bgColor');
        const eraseModeBtn = document.getElementById('eraseMode');
        const moveModeBtn = document.getElementById('moveMode');
        const brushSlider = document.getElementById('brushSize');

        let uploadedImage = new Image();
        let isImageLoaded = false;
        let scale = 1, offset = { x: 0, y: 0 };
        let mode = 'move'; // 'move' or 'erase'
        let panning = false, erasing = false;
        let maskCanvas = document.createElement('canvas');
        let maskCtx = maskCanvas.getContext('2d');

        imageInput.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    uploadedImage.src = ev.target.result;
                    uploadedImage.onload = () => {
                        isImageLoaded = true;
                        maskCanvas.width = uploadedImage.width;
                        maskCanvas.height = uploadedImage.height;
                        maskCtx.fillStyle = 'black';
                        maskCtx.fillRect(0, 0, maskCanvas.width, maskCanvas.height);
                        scale = 1; offset = { x: 0, y: 0 };
                        downloadBtn.disabled = false;
                        render();
                    }
                }
                reader.readAsDataURL(file);
            }
        };

        function render() {
            if (!isImageLoaded) return;
            ctx.fillStyle = bgColorInput.value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width / 2 + offset.x, canvas.height / 2 + offset.y);
            ctx.scale(scale, scale);
            
            // Draw image with mask
            ctx.globalCompositeOperation = 'source-over';
            
            let tempCanvas = document.createElement('canvas');
            tempCanvas.width = uploadedImage.width;
            tempCanvas.height = uploadedImage.height;
            let tempCtx = tempCanvas.getContext('2d');
            
            tempCtx.drawImage(uploadedImage, 0, 0);
            tempCtx.globalCompositeOperation = 'destination-in';
            tempCtx.drawImage(maskCanvas, 0, 0);
            
            ctx.filter = `brightness(${document.getElementById('brightnessSlider').value}%)`;
            ctx.drawImage(tempCanvas, -uploadedImage.width / 2, -uploadedImage.height / 2);
            ctx.restore();
            updateSize();
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        canvas.onmousedown = canvas.ontouchstart = (e) => {
            if (mode === 'move') panning = true;
            else {
                erasing = true;
                paintMask(e);
            }
        };

        window.onmousemove = window.ontouchmove = (e) => {
            if (panning) {
                const pos = getMousePos(e); // Simple delta movement
                render();
            } else if (erasing) {
                paintMask(e);
            }
        };

        function paintMask(e) {
            const pos = getMousePos(e);
            const zoom = scale;
            const brushSize = brushSlider.value / zoom;
            
            // Project canvas pos to image coords
            const imgX = (pos.x - canvas.width/2 - offset.x) / zoom + uploadedImage.width/2;
            const imgY = (pos.y - canvas.height/2 - offset.y) / zoom + uploadedImage.height/2;

            maskCtx.globalCompositeOperation = 'destination-out';
            maskCtx.beginPath();
            maskCtx.arc(imgX, imgY, brushSize, 0, Math.PI * 2);
            maskCtx.fill();
            render();
        }

        window.onmouseup = window.ontouchend = () => { panning = erasing = false; };

        eraseModeBtn.onclick = () => { mode = 'erase'; eraseModeBtn.classList.add('active'); moveModeBtn.classList.remove('active'); document.getElementById('eraseSettings').style.display = 'block'; };
        moveModeBtn.onclick = () => { mode = 'move'; moveModeBtn.classList.add('active'); eraseModeBtn.classList.remove('active'); document.getElementById('eraseSettings').style.display = 'none'; };
        
        zoomSlider.oninput = () => { scale = zoomSlider.value; document.getElementById('zoomValue').innerText = Math.round(scale*100)+'%'; render(); };
        bgColorInput.oninput = render;
        
        function updateSize() {
            const kb = ((canvas.toDataURL('image/jpeg', document.getElementById('qualitySlider').value).length)*3/4/1024).toFixed(1);
            document.getElementById('sizeEstimate').innerText = `Size: ‚âà ${kb} KB`;
        }

        downloadBtn.onclick = () => {
            const link = document.createElement('a');
            link.download = 'form-mitra-pro.jpg';
            link.href = canvas.toDataURL('image/jpeg', parseFloat(document.getElementById('qualitySlider').value));
            link.click();
        };
    </script>
</body>
</html>