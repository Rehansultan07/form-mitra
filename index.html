<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Mitra - Agent Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #007bff; --dark: #343a40; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #eef2f3; display: none; } /* Pehle chupa rahega check hone tak */
        
        /* Sidebar & Navbar */
        .navbar { background: var(--primary); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .main-container { display: flex; min-height: calc(100vh - 60px); }
        .sidebar { width: 250px; background: var(--dark); color: white; padding: 20px; }
        .content { flex: 1; padding: 30px; }

        /* Dashboard Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.3s; cursor: pointer; border-top: 4px solid var(--primary); }
        .card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        .card i { font-size: 40px; color: var(--primary); margin-bottom: 15px; }
        .card h3 { margin: 10px 0; font-size: 18px; color: #333; }

        .wallet-box { background: #28a745; color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .logout-btn { background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo"><b>FORM MITRA</b> | Digital Seva</div>
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="wallet-box">Wallet: â‚¹0.00</div>
            <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
    </nav>

    <div class="main-container">
        <aside class="sidebar">
            <p><i class="fas fa-user-circle"></i> <span id="agentName">Loading...</span></p>
            <hr>
            <p><i class="fas fa-home"></i> Dashboard</p>
            <p><i class="fas fa-history"></i> History</p>
            <p><i class="fas fa-headset"></i> Support</p>
        </aside>

        <main class="content">
            <h2 id="welcomeText">Welcome back!</h2>
            <div class="grid">
                <div class="card"><i class="fas fa-id-card"></i><h3>PAN Card</h3><p>New / Correction</p></div>
                <div class="card"><i class="fas fa-university"></i><h3>AEPS</h3><p>Cash Withdrawal</p></div>
                <div class="card"><i class="fas fa-mobile-alt"></i><h3>Recharge</h3><p>Mobile & DTH</p></div>
                <div class="card"><i class="fas fa-bolt"></i><h3>Electricity</h3><p>Bill Payment</p></div>
                <div class="card"><i class="fas fa-file-invoice"></i><h3>ITR Filing</h3><p>Income Tax</p></div>
                <div class="card"><i class="fas fa-plane"></i><h3>Booking</h3><p>Air & Rail</p></div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA38pu8oY78SaLciR3JzwdwC4avpdEHBg4",
            authDomain: "formmitra-auth.firebaseapp.com",
            projectId: "formmitra-auth",
            databaseURL: "https://formmitra-auth-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Security logic
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userRef = ref(db, 'agents/' + user.uid);
                get(userRef).then((snapshot) => {
                    const userData = snapshot.val();
                    
                    // Approval Check
                    if (userData && userData.status === "Approved") {
                        document.body.style.display = "block"; // Sirf approved ko dikhao
                        document.getElementById('agentName').innerText = userData.name;
                        document.getElementById('welcomeText').innerText = "Welcome back, " + userData.name;
                    } 
                    else {
                        // Agar Approved nahi hai
                        alert("Aapka account abhi Pending hai ya Suspended hai. Admin approval ka intezar karein.");
                        window.location.href = "login.html";
                    }
                });
            } else {
                window.location.href = "login.html";
            }
        });

        window.logout = () => {
            signOut(auth).then(() => { window.location.href = "login.html"; });
        };
    </script>
</body>
</html>