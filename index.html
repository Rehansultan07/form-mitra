<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agent Registration - Form Mitra</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body {
  font-family: Inter, Segoe UI, sans-serif;
  background: linear-gradient(135deg,#e3ecf5,#f9fbff);
  margin: 0; padding: 20px;
}

.card {
  max-width: 560px;
  margin: auto;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 15px 40px rgba(0,0,0,.12);
  overflow: hidden;
}

.header {
  background: #223d5d;
  color: white;
  padding: 22px;
  text-align: center;
  font-weight: 700;
}

.progress {
  height: 6px;
  background: #eaeaea;
}
.bar {
  height: 100%;
  width: 33%;
  background: #3498db;
  transition: .3s;
}

.content {
  padding: 26px;
}

.step { display: none; }
.step.active { display: block; animation: fade .3s; }

@keyframes fade { from {opacity:.3; transform:translateY(10px);} to {opacity:1;} }

.input-group {
  position: relative;
  margin-bottom: 16px;
}

.input-group i {
  position: absolute;
  left: 12px;
  top: 14px;
  color: #777;
}

input {
  width: 100%;
  padding: 12px 12px 12px 38px;
  border-radius: 8px;
  border: 1px solid #ccc;
  outline: none;
  font-size: 15px;
}

input:focus {
  border-color: #3498db;
  box-shadow: 0 0 0 3px rgba(52,152,219,.15);
}

.btn {
  width: 100%;
  padding: 14px;
  border-radius: 8px;
  border: none;
  font-weight: 700;
  cursor: pointer;
}

.btn-blue { background:#223d5d; color:white; }
.btn-green { background:#27ae60; color:white; }

.qr-box {
  text-align: center;
  padding: 20px;
  border: 2px dashed #3498db;
  border-radius: 10px;
}

.qr-box img { width: 180px; }

.loading {
  opacity: .6;
  pointer-events: none;
}
</style>
</head>

<body>

<div class="card">
  <div class="header">Agent Registration</div>
  <div class="progress"><div class="bar" id="bar"></div></div>

  <div class="content">

    <div id="step1" class="step active">
      <div class="input-group">
        <i class="fa fa-user"></i>
        <input id="name" placeholder="Full Name">
      </div>

      <div class="input-group">
        <i class="fa fa-envelope"></i>
        <input id="email" type="email" placeholder="Email Address">
      </div>

      <div class="input-group">
        <i class="fa fa-phone"></i>
        <input id="phone" placeholder="Mobile Number">
      </div>

      <button class="btn btn-blue" onclick="goStep(2)">Next</button>
    </div>

    <div id="step2" class="step">
      <div class="input-group">
        <i class="fa fa-location-dot"></i>
        <input id="address" placeholder="Shop Address">
      </div>

      <div class="input-group">
        <i class="fa fa-lock"></i>
        <input id="password" type="password" placeholder="Min 6 characters">
      </div>

      <button class="btn btn-blue" onclick="goStep(3)">Next</button>
    </div>

    <div id="step3" class="step">
      <div class="qr-box">
        <h4>Registration Fee â‚¹999</h4>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=REHAN@UPI&pn=FormMitra&am=999">
        <small style="color:#e74c3c">Scan & Pay using UPI</small>
      </div>

      <div class="input-group">
        <i class="fa fa-receipt"></i>
        <input id="utr" placeholder="Enter UTR / Transaction ID">
      </div>

      <button class="btn btn-green" onclick="handleSignup()" id="submitBtn">
        Finish Registration
      </button>
    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyA38pu8oY78SaLciR3JzwdwC4avpdEHBg4",
 authDomain: "formmitra-auth.firebaseapp.com",
 databaseURL: "https://formmitra-auth-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

window.goStep = (n) => {
 document.querySelectorAll(".step").forEach(s => s.classList.remove("active"));
 document.getElementById("step"+n).classList.add("active");
 document.getElementById("bar").style.width = (n*33)+"%";
};

window.handleSignup = async () => {
 const btn = document.getElementById("submitBtn");
 btn.innerText = "Processing...";
 btn.classList.add("loading");

 const name = name.value.trim();
 const email = email.value.trim();
 const password = password.value;
 const phone = phone.value.trim();
 const address = address.value.trim();
 const utr = utr.value.trim();

 if(!name || !email || !password || !utr) {
   alert("Please fill all required fields!");
   btn.innerText = "Finish Registration";
   return;
 }

 try {
   const userCredential = await createUserWithEmailAndPassword(auth,email,password);
   const user = userCredential.user;

   await set(ref(db,'agents/'+user.uid),{
     name,email,phone,address,utr,status:"Pending",createdAt:Date.now()
   });

   alert("Success! Admin approval ke baad account active hoga.");
   location.href = "login.html";

 } catch(e){
   alert(e.message);
 }

 btn.innerText = "Finish Registration";
 btn.classList.remove("loading");
};
</script>

</body>
</html>
